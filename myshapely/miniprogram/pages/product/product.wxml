<!--miniprogram/pages/product/product.wxml-->
<import src="../../templates/goodItemCard/goodItemCard.wxml" />

<view class="header" style="padding-top:{{statusBarHeight}}px">
  <view class="navbar">
    <view class="icon-container" bindtap="back">
      <icon class="iconfont icon-back" style="font-size:35rpx;color:black"></icon>
    </view>
    <view class="title">{{navbarTitle}}</view>
  </view>
  <scroll-view class="subCate_list" scroll-x scroll-with-animation scroll-left="{{row_scrollTop}}">
    <view wx:for="{{subCates}}" class="{{subCate===item.id?'selected_subCate':'subCate_item'}}" data-index='{{index}}' data-id='{{item.id}}' bindtap='selectSubCate' wx:key="key" wx:for-index="index">{{item.name}}</view>
  </scroll-view>
</view>

<view class="goodItem-container">
  <view wx:for="{{tmpSeries}}" wx:for-index="index" wx:key="key" data-index="{{index}}" bindtap="toSingle"> 
    <template wx:if="{{item.mode=='series'}}" is="goodItemCard1" data="{{...item}}"></template>
    <template wx:if="{{item.mode=='single'}}" is="goodItemCard2" data="{{...item}}"></template>
  </view>
</view>


<view hidden="{{!openCategory&&!openAccount}}" catchtap="closeBg" class="bg">
  <view hidden="{{!openCategory}}" catchtap="catchClose" class="category-scroll-container">
    <scroll-view scroll-y="true" scroll-top="{{scrollTop}}" scroll-into-view="{{toView}}">
      <view id="cc" class="padding"></view>
      <view hidden="{{toView!='cc'}}" class="padding"></view>
      <view hidden="{{toView!='cc'}}" class="padding"></view>
      <view wx:for="{{categories}}" wx:for-item="category" wx:for-index="categoryIndex" wx:key="key">
        <view id="{{'c'+category.id}}" data-cid="{{category.id}}" catchtap="chooseCbtn" class="cbtn" hover-class="hover-btn">{{category.name}}</view>
        <view hidden="{{toView!='c'+category.id}}">
          <view wx:for="{{category.subCates}}" wx:for-item="subCate" wx:for-index="subCateIndex" wx:key="key" class="{{subCate.id==0?'new':'sbtn'}}" style="{{sid==subCate.id?'font-size:35rpx;font-weight:bold':''}}" hover-class="hover-btn" catchtap="toProductPage" data-sid="{{subCate.id}}">{{subCate.name}}</view> 
        </view>
      </view>
    </scroll-view>
  </view>

  <view hidden="{{!openAccount}}" catchtap="catchClose" class="myAccount-container">
    <view hidden="{{!userInfo.bind}}">
      <view class="avatar-container">
        <view class="avatar">
          <open-data type="userAvatarUrl"></open-data>
        </view>
        <view class="title">{{userInfo.name}}</view>
      </view>
      <view class="item" hover-class="hover-btn" >我的订单</view>
      <view class="item" hover-class="hover-btn" catchtap="register">个人信息</view>
      <view class="item" hover-class="hover-btn" catchtap="toContact">联系我们</view>
      <view wx:if="{{userInfo.xm}}" class="item" hover-class="hover-btn" catchtap="uploadProduct">商品管理</view>
    </view>
    
    <view hidden="{{userInfo.bind}}">
      <view class="avatar-container">
        <view class="avatar">
          <open-data type="userAvatarUrl"></open-data>
        </view>
        <view class="title" catchtap="register">登入</view>
      </view>
      <view class="item" hover-class="hover-btn"  catchtap="toContact">联系我们</view>
    </view>
  </view>
</view>

<view class="tab-container">
  <view class="icon-container">
    <icon class="iconfont icon-shoppingCart"></icon>
  </view>
  <view catchtap="openCategory" class="{{openCategory?'chosenTab':'tab'}}">菜单</view>
  <view class="icon-container">
    <icon class="iconfont icon-account" style="font-weight:bold" catchtap="openAccount"></icon>
  </view>
</view>

<!-- 产品页面 -->
<view class="single {{singlePage.show?'show':'hide'}}" style="padding-top:{{statusBarHeight}}px">
  <view class="icon-container" catchtap="closeSingle">
    <icon class="iconfont icon-close" style="font-size:35rpx;color:black;font-weight:bold"></icon>
  </view>
  <swiper current="{{singlePage.seriesIndex}}" bindchange="changeSingle" style="height:100%">
    <swiper-item wx:for="{{series}}" wx:key="key" wx:for-item="seriesItem">
      <scroll-view scroll-y scroll-with-animation scroll-top='{{singlePage.topNum}}' style='height:100%' catchtouchmove="{{ture}}">
        <swiper indicator-dots="{{true}}" current="{{seriesItem.imageIndex?seriesItem.imageIndex:0}}" style="height:1040rpx"  vertical="{{true}}" bindchange="swiperImage">
          <swiper-item wx:for="{{seriesItem.products[seriesItem.singleIndex?seriesItem.singleIndex:0].colors[seriesItem.colorIndex?seriesItem.colorIndex:0].images}}" wx:key="key" wx:for-item="imageItem">
            <image style="width:750rpx;height:1040rpx;" src="{{imageItem}}"></image>
          </swiper-item>
        </swiper>
        <view class="information-container">
          <view class="name_prices">
            <view class="name">{{seriesItem.products[seriesItem.singleIndex].name}}</view>
            <view class="prices-container">
              <view>￥{{seriesItem.products[seriesItem.singleIndex].prices[0].price}}.00 </view>
              <view style="margin-left:20rpx;color:#fe5400" hidden="{{!seriesItem.products[seriesItem.singleIndex].prices[1].show}}">会员价 ￥{{seriesItem.products[seriesItem.singleIndex].prices[1].price}}.00 </view>
              <view style="margin-left:20rpx;color:red" hidden="{{!seriesItem.products[seriesItem.singleIndex].prices[2].show}}">秒杀价 ￥{{seriesItem.products[seriesItem.singleIndex].prices[2].price}}.00 </view>
            </view>
          </view>
          <view class="add_cart">
            <view class="add" bindtap="openAddCart">添加</view>
            <view class="cart-container">
              <view class="i-container">
                <icon class="iconfont icon-shoppingCart" style="font-size:50rpx;"></icon>
              </view>
            </view>
          </view>
          <textarea disabled="{{true}}" auto-height="{{true}}" class="intro">
            {{seriesItem.products[seriesItem.singleIndex].introduction}}
          </textarea>
          <view class="colors-title" hidden="{{seriesItem.products[seriesItem.singleIndex].colors.length==1}}">{{seriesItem.products[seriesItem.singleIndex].colors.length}}种颜色</view>
          <scroll-view class="color-list" scroll-x scroll-with-animation hidden="{{seriesItem.products[seriesItem.singleIndex].colors.length==1}}">
            <view style="display:flex;flex-direction:row">
              <view wx:for="{{seriesItem.products[seriesItem.singleIndex].colors}}" class="color-container"  wx:for-index="colorIndex"  wx:for-item="colorItem" data-color='{{colorItem.color}}' data-colorindex="{{colorIndex}}" bindtap='selectColor' wx:key="key">
                <image src="{{colorItem.images[0]}}"></image>
                <view class="color">{{colorItem.color}}</view>
              </view>
            </view>
          </scroll-view>
          <view hidden="{{seriesItem.products[seriesItem.singleIndex].colors.length==1}}" style="height:100rpx;" class="padding"></view>
          <view hidden="{{seriesItem.products.length==1}}" class="colors-title">系列产品</view>
          <scroll-view hidden="{{seriesItem.products.length==1}}" class="sproduct-list" scroll-x scroll-with-animation>
            <view style="display:flex;flex-direction:row">
              <view wx:for="{{seriesItem.products}}" class="sproduct-container"  wx:for-index="productIndex"  wx:for-item="productItem" data-productindex="{{productIndex}}" bindtap='selectProduct' wx:key="key" hidden="{{productIndex==seriesItem.singleIndex}}">
                <image src="{{productItem.colors[0].images[0]}}"></image>
                <view class="sproduct-name">{{productItem.name}}</view>
                <view class="sproduct-price">￥{{productItem.prices[0].price}}.00</view>
              </view>
            </view>
          </scroll-view>
          <view style="height:500rpx;" class="padding"></view>
        </view>
      </scroll-view>
    </swiper-item>
  </swiper>
</view>

<action-sheet hidden="{{addCart.hidden}}" bindchange="addCartChange"> 
  <view class="action-sheet-container">
    <view class="storages-container">
      <view class="storages">
        <scroll-view>
          <view class="sizes">
            <view wx:for="{{addCart.storages}}" wx:key="key" wx:for-item="size" class="{{size.show?'size-yes':'size-no'}}" style="{{index%2==1?'margin-right:0rpx':''}}" data-show="{{size.show}}" data-type="{{size.type}}" bindtap="addCart">
              <view>{{size.type}}</view>
              <view hidden="{{size.show}}" class="message">
                <icon class="iconfont icon-message" style="font-size:40rpx"></icon>
              </view>
            </view>
          </view>
          <view hidden="{{!addCart.messageText}}" class="message-text">
            <icon class="iconfont icon-message" style="font-size:40rpx"></icon>
            <view style="font-size:30rpx;color:black;">到货时我们会联系您</view>
          </view>
        </scroll-view>
        <view class="my-size">我的尺码是多少？
        </view>
      </view>
    </view>
  </view>
</action-sheet>

<view class="success-tab-container" hidden="{{!addCart.addCartSuccess}}">
  <view class="toast">{{addCart.productSize}} 已添加至您的购物袋</view>
  <view class="check">查看</view>
</view>